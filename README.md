# 极简聊天室 - Minimalist Chat

一个简洁、高效、流畅的现代聊天应用，采用苹果级设计理念，追求极致用户体验。

## ✨ 特性

### 🎯 核心功能

- **流畅聊天**: 实时消息传递，支持文本、图片、表情等多种消息类型
- **表情系统**: 分类表情选择器，支持搜索和最近使用记录
- **图片功能**: 拖拽上传、预览查看、缩放旋转、压缩处理
- **响应式设计**: 完美适配手机、平板、桌面，触摸友好

### 🚀 性能优化

- **60fps 流畅动画**: 使用 Framer Motion 实现苹果级动画效果
- **虚拟化列表**: 使用 `@tanstack/react-virtual` 处理大量消息
- **动态高度测量**: 智能计算消息高度，避免跳动
- **滚动优化**: 粘底策略、未读提示、智能滚动

### 🔐 Telegram 风格端到端加密

- **一键启用**: 点击按钮即可启用端到端加密，无需复杂配置
- **透明体验**: 加密过程对用户完全透明，专注于聊天体验
- **自动管理**: 自动处理密钥生成、会话管理和密钥轮换
- **军事级安全**: AES-GCM-256 加密算法，确保消息安全
- **前向保密**: 支持密钥轮换，即使密钥泄露历史消息仍然安全
- **消息完整性**: 防止消息被篡改和重放攻击

### 🎨 用户体验

- **极简设计**: 专注内容与交互，减少视觉干扰
- **流畅交互**: 零延迟响应，苹果级操作体验
- **智能提示**: 未读消息提示、滚动到底部按钮
- **错误处理**: 友好的错误提示和恢复机制

### 🔧 技术特性

- **图片处理**: 客户端压缩、EXIF 清理、进度显示
- **本地存储**: 表情最近使用、用户偏好设置
- **可访问性**: ARIA 标签、键盘导航、语义化 HTML
- **PWA 支持**: 渐进式 Web 应用，可安装到桌面

## 🛠️ 技术栈

- **框架**: Next.js 14 (App Router)
- **语言**: TypeScript
- **样式**: Tailwind CSS
- **动画**: Framer Motion
- **虚拟化**: @tanstack/react-virtual
- **文件上传**: react-dropzone
- **图标**: Lucide React
- **工具**: date-fns, clsx, tailwind-merge
- **加密**: WebCrypto API + 自定义加密管理器

## 🚀 快速开始

### 安装依赖

```bash
npm install
```

### 启动开发服务器

```bash
npm run dev
```

### 构建生产版本

```bash
npm run build
```

## 📱 功能演示

访问 [http://localhost:3000](http://localhost:3000) 体验完整功能：

- **主聊天页面**: `/` - 核心聊天功能
- **加密测试**: `/encryption-test` - Telegram 风格加密系统测试

## 🔐 加密功能使用

### 启用加密

1. 在聊天界面点击"启用端到端加密"按钮
2. 系统自动生成密钥并建立加密会话
3. 聊天头部显示加密状态指示器
4. 所有文本消息自动加密传输

### 加密特性

- **自动加密**: 启用后所有文本消息自动加密
- **状态显示**: 清晰的加密状态指示器
- **错误恢复**: 网络中断后自动重新建立加密
- **会话管理**: 自动清理过期会话

### 安全保证

- **端到端加密**: 只有参与者能解密消息
- **前向保密**: 密钥轮换确保历史消息安全
- **消息完整性**: 防止消息被篡改
- **重放防护**: 防止消息重放攻击

## 📁 项目结构

```
├── app/                    # Next.js App Router
│   ├── page.tsx           # 主聊天页面
│   ├── encryption-test/   # 加密测试页面
│   └── layout.tsx         # 根布局
├── components/            # React 组件
│   ├── ChatHeader.tsx     # 聊天头部
│   ├── MessageList.tsx    # 消息列表
│   ├── MessageInput.tsx   # 消息输入
│   ├── EncryptionStatus.tsx # 加密状态组件
│   └── ...
├── lib/                   # 工具库
│   ├── e2ee/             # 加密系统
│   │   ├── manager.ts    # 加密管理器
│   │   ├── crypto.ts     # 加密核心
│   │   └── storage.ts    # 存储管理
│   └── ...
├── hooks/                 # React Hooks
│   ├── useEncryption.ts  # 加密 Hook
│   └── ...
└── types/                 # TypeScript 类型定义
```

## 🎯 设计理念

### 参考 Telegram

- **简洁性**: 用户无需复杂配置，一键启用加密聊天
- **透明性**: 加密过程对用户透明，专注于聊天体验
- **可靠性**: 自动处理密钥管理，无需手动干预
- **安全性**: 军事级加密算法，确保消息安全

### 用户体验

- **一键启用**: 点击"加密聊天"按钮即可启用
- **视觉反馈**: 清晰的加密状态指示器
- **自动恢复**: 网络中断后自动重新建立加密
- **设备同步**: 支持多设备间的加密状态同步

## 🔧 开发指南

### 添加新功能

1. 在 `components/` 目录创建新组件
2. 在 `lib/` 目录添加相关工具函数
3. 在 `types/` 目录定义 TypeScript 类型
4. 更新文档和测试

### 自定义加密

```typescript
import { useEncryption } from '@/hooks/useEncryption'

function MyComponent() {
  const { isEnabled, enable, disable, encryptMessage } = useEncryption({
    participants: ['user1', 'user2'],
    autoEnable: false
  })

  const handleSendEncrypted = async (message: string) => {
    if (isEnabled) {
      const encrypted = await encryptMessage(message, 'user1')
      // 发送加密消息
    }
  }
}
```

## 🧪 测试

### 功能测试

访问 `/encryption-test` 页面进行完整的功能测试：

1. **加密启用**: 测试加密会话建立
2. **消息加密**: 测试消息加密/解密
3. **会话管理**: 测试会话状态管理
4. **错误处理**: 测试各种错误场景

### 性能测试

- **加密性能**: 测试加密/解密速度
- **内存使用**: 测试内存占用
- **网络延迟**: 测试网络影响
- **并发处理**: 测试多用户场景

## 📈 性能优化

### 加密性能

- **异步操作**: 非阻塞加密/解密
- **批量处理**: 多条消息批量加密
- **缓存优化**: 密钥和会话缓存
- **内存管理**: 及时释放资源

### 用户体验

- **即时反馈**: 实时状态更新
- **平滑动画**: 60fps 动画效果
- **错误恢复**: 自动错误处理
- **离线支持**: 离线消息处理

## 🛡️ 安全特性

### 加密安全

- **前向保密**: 密钥定期轮换
- **消息完整性**: 防止篡改
- **重放防护**: 消息ID验证
- **密钥验证**: 指纹验证

### 隐私保护

- **元数据最小化**: 最小化数据收集
- **本地处理**: 敏感数据本地处理
- **自动清理**: 过期数据自动删除
- **用户控制**: 用户完全控制数据

## 🔮 未来扩展

### 高级功能

- **群聊加密**: 支持群组加密聊天
- **文件加密**: 支持文件加密传输
- **语音加密**: 支持语音加密通话
- **视频加密**: 支持视频加密通话

### 平台扩展

- **移动端**: 支持移动应用
- **桌面端**: 支持桌面应用
- **浏览器扩展**: 支持浏览器扩展
- **API 接口**: 提供开发者API

## 📄 许可证

MIT License - 详见 LICENSE 文件

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

1. Fork 项目
2. 创建功能分支
3. 提交更改
4. 推送到分支
5. 创建 Pull Request

## 📞 支持

如有问题或建议，请：

- 提交 [Issue](https://github.com/your-repo/issues)
- 发送邮件至 <support@example.com>
- 加入我们的 [Discord](https://discord.gg/your-server)
