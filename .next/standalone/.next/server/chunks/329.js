"use strict";exports.id=329,exports.ids=[329],exports.modules={10329:(a,b,c)=>{c.r(b),c.d(b,{default:()=>ag});var d=c(21124),e=c(38301),f=c(92667),g=c(49503),h=c(8294),i=c(71213),j=c(87278),k=c(21763),l=c(54399);function m({conversation:a,onBack:b,isEncryptionEnabled:c=!1,isEncryptionEstablishing:e=!1,typingText:f,onStartCall:m,onStartVideo:n,onOpenInfo:o}){let p=a.participants.filter(a=>"1"!==a.id),q=p[0],r=a.isGroup,s=r?`${p.length} 人`:f||(q?.isOnline?"在线":"离线");return(0,d.jsx)(g.P.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"glass-effect border-b border-gray-200/50 px-4 py-3 safe-area-inset-top",children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{className:"flex items-center space-x-3",children:[b&&(0,d.jsx)("button",{onClick:b,className:"icon-btn touch-feedback",children:(0,d.jsx)(h.A,{className:"w-5 h-5"})}),(0,d.jsxs)("div",{className:"flex items-center space-x-3",children:[r?(0,d.jsx)("div",{className:"flex -space-x-2",children:p.slice(0,3).map(a=>(0,d.jsx)("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-primary-400 to-primary-600 flex items-center justify-center text-white text-xs font-medium border-2 border-white",children:a.name?.charAt(0)||"U"},a.id))}):(0,d.jsxs)("div",{className:"relative",children:[(0,d.jsx)("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-primary-400 to-primary-600 flex items-center justify-center text-white font-medium",children:q?.name?.charAt(0)||"U"}),q?.isOnline&&(0,d.jsx)("div",{className:"absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-green-500 rounded-full border-2 border-white"})]}),(0,d.jsxs)("div",{children:[(0,d.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,d.jsx)("h1",{className:"font-semibold text-gray-900",children:a.isGroup?a.groupName:q?.name}),(0,d.jsx)(l.P,{isEnabled:c,isEstablishing:e})]}),(0,d.jsx)("p",{className:"text-sm text-gray-500",children:s})]})]})]}),(0,d.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,d.jsx)("button",{className:"icon-btn touch-feedback",onClick:m,children:(0,d.jsx)(i.A,{className:"w-5 h-5"})}),(0,d.jsx)("button",{className:"icon-btn touch-feedback",onClick:n,children:(0,d.jsx)(j.A,{className:"w-5 h-5"})}),(0,d.jsx)("button",{className:"icon-btn touch-feedback",onClick:o,children:(0,d.jsx)(k.A,{className:"w-5 h-5"})})]})]})})}var n=c(37941),o=c(71613),p=c(16636),q=c(22842),r=c(10708),s=c(86865),t=c(30733),u=c(40284),v=c(37635),w=c(75785),x=c(27278);function y(a){return(0,v.A)(a)?(0,w.A)(a,"HH:mm"):(0,x.A)(a)?"昨天":(0,w.A)(a,"MM-dd")}function z(a,b){return(0,w.A)(a,"yyyy-MM-dd")===(0,w.A)(b,"yyyy-MM-dd")}var A=c(87788),B=c(64714);function C({message:a,isOwn:b,isLastInGroup:c,onImageClick:f,onReply:h,onDelete:i,onToggleStar:j,onRetry:k}){let[l,m]=(0,e.useState)(!1),[n,v]=(0,e.useState)(!1),[w,x]=(0,e.useState)(null),z=async()=>{if("text"===a.type)try{await navigator.clipboard.writeText(a.content),m(!0),setTimeout(()=>m(!1),800)}catch{}};return(0,d.jsxs)(g.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.2},className:(0,A.cn)("flex mb-1",b?"justify-end":"justify-start"),onContextMenu:a=>{a.preventDefault(),v(!0)},onPointerDown:a=>{if("touch"===a.pointerType){let b=setTimeout(()=>v(!0),500),c=()=>{clearTimeout(b)},d=a.currentTarget;d.addEventListener("pointerup",c,{once:!0}),d.addEventListener("pointercancel",c,{once:!0})}},children:[(0,d.jsxs)("div",{className:(0,A.cn)("flex flex-col max-w-[70%]",b?"items-end":"items-start"),children:[(0,d.jsx)(g.P.div,{animate:l?{scale:1.02}:{scale:1},transition:{duration:.12},className:(0,A.cn)("message-bubble",b?"sent":"received"),children:"image"===a.type?(0,d.jsxs)("div",{className:"relative cursor-pointer rounded-lg overflow-hidden max-w-xs",onClick:()=>f(a.content),children:[(0,d.jsx)("img",{src:a.content,alt:"消息图片",className:"w-full h-auto object-cover",loading:"lazy",onLoad:a=>{try{let{naturalWidth:b,naturalHeight:c}=a.currentTarget;x({width:b,height:c})}catch(a){console.error("Failed to load image:",a)}}}),"sending"===a.status&&(0,d.jsx)("div",{className:"absolute inset-0 bg-black/40 flex items-end",children:(0,d.jsx)("div",{className:"w-full h-1 bg-white/30",children:(0,d.jsx)("div",{className:"h-full bg-white",style:{width:`${Math.max(5,a.uploadProgress??0)}%`}})})}),"failed"===a.status&&(0,d.jsx)("div",{className:"absolute inset-0 bg-black/30 flex items-center justify-center",children:(0,d.jsx)("button",{className:"px-3 py-1 bg-white/90 rounded text-xs",onClick:b=>{b.stopPropagation();try{k?.(a.id)}catch(a){console.error("Failed to retry message:",a)}},children:"重试"})})]}):B.x.isEncryptedMessage(a.content)?(0,d.jsxs)("div",{className:"flex items-center space-x-2 text-white/90",children:[(0,d.jsx)(q.A,{className:"w-4 h-4"}),(0,d.jsx)("span",{className:"text-sm",children:"\uD83D\uDD12 加密消息"})]}):(0,d.jsxs)("div",{className:"text-selection",onDoubleClick:z,children:[a.replyTo&&(0,d.jsxs)("div",{className:"mb-1 p-2 rounded-lg text-xs",style:{background:"rgba(0,0,0,.04)"},children:["回复 \xb7 #",a.replyTo]}),a.content]})}),c&&(0,d.jsxs)("div",{className:(0,A.cn)("flex items-center space-x-1 mt-1 text-xs text-gray-500",b?"justify-end":"justify-start"),children:[(0,d.jsx)("span",{children:y(a.timestamp)}),b&&(()=>{switch(a.status){case"sending":return(0,d.jsx)("div",{className:"flex items-center space-x-1",children:(0,d.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-pulse"})});case"sent":return(0,d.jsx)(o.A,{className:"w-3 h-3 text-gray-400"});case"delivered":return(0,d.jsx)(p.A,{className:"w-3 h-3 text-gray-400"});case"read":return(0,d.jsx)(p.A,{className:"w-3 h-3 text-blue-500"});case"failed":return(0,d.jsx)("div",{className:"w-3 h-3 bg-red-500 rounded-full"});default:return null}})()]})]}),n&&(0,d.jsxs)("div",{className:"absolute z-20 mt-8 bg-white rounded-xl shadow border p-1 flex",style:{borderColor:"var(--border)"},onMouseLeave:()=>v(!1),children:[(0,d.jsx)("button",{className:"icon-btn",onClick:()=>{z(),v(!1)},title:"复制",children:(0,d.jsx)(r.A,{className:"w-4 h-4"})}),(0,d.jsx)("button",{className:"icon-btn",onClick:()=>{h?.(a.id),v(!1)},title:"回复",children:(0,d.jsx)(s.A,{className:"w-4 h-4"})}),(0,d.jsx)("button",{className:"icon-btn",onClick:()=>{j?.(a.id),v(!1)},title:"标星",children:(0,d.jsx)(t.A,{className:(0,A.cn)("w-4 h-4",a.starred&&"text-yellow-500")})}),(0,d.jsx)("button",{className:"icon-btn",onClick:()=>{i?.(a.id),v(!1)},title:"删除",children:(0,d.jsx)(u.A,{className:"w-4 h-4 text-red-500"})})]})]})}function D({messages:a,currentUserId:b,onImageClick:c,onReply:h,onDelete:i,onToggleStar:j,onRetry:k}){let l=(0,e.useRef)(null),[m,o]=(0,e.useState)(!0),[p,q]=(0,e.useState)(0),[r,s]=(0,e.useState)(!1),t=(0,n.Te)({count:a.length,getScrollElement:()=>l.current,estimateSize:()=>64,overscan:5,measureElement:a=>a?.getBoundingClientRect().height||64}),u=(0,e.useMemo)(()=>a.findIndex(a=>a.senderId!==b&&"read"!==a.status),[a,b]),v=(0,e.useCallback)((a="smooth")=>{l.current&&l.current.scrollTo({top:l.current.scrollHeight,behavior:a})},[]);(0,e.useCallback)(()=>{if(!l.current)return;let{scrollTop:a,scrollHeight:b,clientHeight:c}=l.current,d=b-a-c<100;o(d),m&&!d&&p>0&&s(!0)},[m,p]);let w=(0,e.useCallback)(()=>{v(),q(0),s(!1)},[v]);return(0,d.jsxs)("div",{className:"relative h-full overflow-hidden","data-testid":"msg-list",children:[(0,d.jsx)("div",{ref:l,className:"h-full overflow-y-auto scrollbar-hide px-4 py-2",children:(0,d.jsx)("div",{style:{height:`${t.getTotalSize()}px`,width:"100%",position:"relative"},children:(0,d.jsx)(f.N,{children:t.getVirtualItems().map(e=>{let f=a[e.index];return(0,d.jsx)("div",{ref:t.measureElement,"data-index":e.index,style:{position:"absolute",top:0,left:0,width:"100%",height:`${e.size}px`,transform:`translateY(${e.start}px)`},children:(0,d.jsx)(g.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.2},style:{height:"100%"},children:f&&((e,f)=>{var l,m,n;let o=f>0?a[f-1]:null,p=f<a.length-1?a[f+1]:null,q=!o||!z(e.timestamp,o.timestamp),r=!p||(l=p.timestamp,m=e.timestamp,n=p.senderId,!(n===e.senderId&&z(l,m)&&3e5>=Math.abs(l.getTime()-m.getTime())));return(0,d.jsxs)("div",{children:[u>=0&&f===u&&(0,d.jsxs)("div",{className:"flex items-center my-3",children:[(0,d.jsx)("div",{className:"flex-1 h-px bg-gray-200"}),(0,d.jsx)("span",{className:"mx-3 text-xs text-primary-600 bg-primary-50 px-2 py-0.5 rounded-full",children:"未读消息"}),(0,d.jsx)("div",{className:"flex-1 h-px bg-gray-200"})]}),q&&(0,d.jsx)(g.P.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},className:"flex justify-center my-4",children:(0,d.jsx)("div",{className:"bg-gray-200/50 px-3 py-1 rounded-full text-xs text-gray-600",children:y(e.timestamp)})}),(0,d.jsx)(C,{message:e,isOwn:e.senderId===b,isLastInGroup:r,onImageClick:c,currentUserId:b,onReply:a=>h?.(a),onDelete:a=>i?.(a),onToggleStar:a=>j?.(a),onRetry:a=>k?.(a)})]},e.id)})(f,e.index)})},e.key)})})})}),(0,d.jsx)(f.N,{children:r&&p>0&&(0,d.jsx)(g.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 z-10",children:(0,d.jsxs)("button",{onClick:w,className:"bg-primary-500 text-white px-4 py-2 rounded-full shadow-lg hover:bg-primary-600 transition-colors text-sm font-medium",children:[p," 条新消息"]})})}),(0,d.jsx)(f.N,{children:u>=0&&(0,d.jsx)(g.P.button,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},onClick:()=>t.scrollToIndex(u,{align:"start"}),className:"absolute top-4 right-4 bg-white/95 backdrop-blur px-3 py-1.5 rounded-full shadow text-xs text-gray-700 border",style:{borderColor:"var(--border)"},children:"跳至未读"})}),(0,d.jsx)(f.N,{children:!m&&(0,d.jsx)(g.P.button,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},onClick:()=>v(),className:"absolute bottom-4 right-4 w-10 h-10 bg-white/90 backdrop-blur-sm rounded-full shadow-lg hover:bg-white transition-colors flex items-center justify-center",children:(0,d.jsx)("svg",{className:"w-5 h-5 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,d.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 14l-7 7m0 0l-7-7m7 7V3"})})})})]})}var E=c(66229),F=c(46148),G=c(42745),H=c(71563);async function I(a,b={}){let{maxWidth:c=1600,maxHeight:d=1600,quality:e=.85,format:f="jpeg"}=b;return new Promise((b,g)=>{let h=document.createElement("canvas"),i=h.getContext("2d"),j=new Image;j.onload=()=>{let{width:a,height:k}=j;a>c&&(k=k*c/a,a=c),k>d&&(a=a*d/k,k=d),h.width=a,h.height=k,i?.drawImage(j,0,0,a,k),h.toBlob(a=>{a?b(a):g(Error("Failed to compress image"))},`image/${f}`,e)},j.onerror=()=>g(Error("Failed to load image")),j.src=URL.createObjectURL(a)})}function J(a){URL.revokeObjectURL(a)}var K=c(53537);function L({value:a,onChange:b,onSend:c,onEmojiClick:f,onImageSelect:h,disabled:i=!1}){let[j,k]=(0,e.useState)(!1),[l,m]=(0,e.useState)(!1),n=(0,e.useRef)(null);(0,e.useRef)(null);let{uploadImage:o}=function(){let[a,b]=(0,e.useState)(new Map),c=(0,e.useCallback)(async a=>{let c=["image/jpeg","image/png","image/gif","image/webp"].includes(a.type)?a.size>0xa00000?{valid:!1,error:"文件大小不能超过 10MB"}:{valid:!0}:{valid:!1,error:"不支持的文件格式，请选择 JPG、PNG、GIF 或 WebP 格式的图片"};if(!c.valid)throw Error(c.error);let d=`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,e=URL.createObjectURL(a),f={id:d,file:a,preview:e,progress:0,status:"uploading"};b(a=>new Map(a).set(d,f));try{b(a=>{let b=new Map(a),c=b.get(d);return c&&b.set(d,{...c,progress:10}),b});let c=await I(a,{maxWidth:1600,maxHeight:1600,quality:.85,format:"jpeg"});b(a=>{let b=new Map(a),c=b.get(d);return c&&b.set(d,{...c,progress:50}),b}),await new Promise(a=>setTimeout(a,1e3)),b(a=>{let b=new Map(a),c=b.get(d);return c&&b.set(d,{...c,progress:100,status:"success"}),b});let f=URL.createObjectURL(c);return J(e),f}catch(a){throw b(b=>{let c=new Map(b),e=c.get(d);return e&&c.set(d,{...e,status:"error",error:a instanceof Error?a.message:"上传失败"}),c}),J(e),a}},[]),d=(0,e.useCallback)(async b=>{let d=a.get(b);if(!d)throw Error("Upload not found");return J(d.preview),c(d.file)},[a,c]),f=(0,e.useCallback)(c=>{let d=a.get(c);d&&(J(d.preview),b(a=>{let b=new Map(a);return b.delete(c),b}))},[a]),g=(0,e.useCallback)(()=>{a.forEach(a=>{J(a.preview)}),b(new Map)},[a]);return{uploads:Array.from(a.entries()).map(([a,b])=>({...b,id:a})),uploadImage:c,retryUpload:d,cancelUpload:f,clearUploads:g}}(),{getRootProps:p,getInputProps:q,isDragActive:r}=(0,K.VB)({accept:{"image/*":[".jpeg",".jpg",".png",".gif",".webp"]},multiple:!1,onDrop:a=>{a.length>0&&a[0]&&h(a[0])}}),s=(0,e.useCallback)(()=>{a.trim()&&c(a.trim())},[a,c]),t=(0,e.useCallback)(a=>{"Enter"!==a.key||a.shiftKey||l||(a.preventDefault(),s())},[s,l]),u=(0,e.useCallback)(a=>{b(a.target.value);let c=a.target;c.style.height="auto",c.style.height=Math.min(c.scrollHeight,120)+"px"},[b]);return(0,d.jsx)(g.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"glass-effect border-t border-gray-200/50 px-4 py-3 safe-area-inset-bottom",children:(0,d.jsxs)("div",{className:"flex items-end space-x-2",children:[(0,d.jsxs)("div",{...p(),className:"relative",children:[(0,d.jsx)("input",{...q()}),(0,d.jsx)("button",{type:"button",className:(0,A.cn)("icon-btn touch-feedback",r&&"bg-primary-100 text-primary-600"),"aria-label":"拖拽上传文件",children:(0,d.jsx)(E.A,{className:"w-5 h-5"})}),r&&(0,d.jsx)(g.P.div,{initial:{opacity:0},animate:{opacity:1},className:"absolute inset-0 bg-primary-500/20 rounded-full"})]}),(0,d.jsx)("button",{type:"button",onClick:()=>document.getElementById("image-input")?.click(),className:"icon-btn touch-feedback","aria-label":"选择图片",children:(0,d.jsx)(F.A,{className:"w-5 h-5"})}),(0,d.jsx)("input",{id:"image-input",type:"file",accept:"image/*",className:"hidden",onChange:a=>{let b=a.target.files?.[0];b&&h(b)}}),(0,d.jsx)("div",{className:"flex-1 relative",children:(0,d.jsx)("textarea",{ref:n,value:a,onChange:u,onCompositionStart:()=>m(!0),onCompositionEnd:a=>{m(!1),b(a.currentTarget.value)},onKeyDown:t,onFocus:()=>k(!0),onBlur:()=>k(!1),placeholder:"输入消息...",className:"chat-input",rows:1,style:{minHeight:"44px",maxHeight:"120px"},"aria-label":"消息输入框","data-testid":"chat-input"})}),(0,d.jsx)("button",{type:"button",onClick:f,className:"icon-btn touch-feedback","aria-label":"打开表情选择器",children:(0,d.jsx)(G.A,{className:"w-5 h-5"})}),(0,d.jsx)(g.P.button,{type:"button",onClick:s,disabled:!a.trim(),whileTap:{scale:.95},className:(0,A.cn)("w-10 h-10 rounded-full flex items-center justify-center transition-all duration-200",a.trim()?"bg-primary-500 text-white hover:bg-primary-600":"bg-gray-200 text-gray-400 cursor-not-allowed"),"aria-label":"发送消息","data-testid":"send",children:(0,d.jsx)(H.A,{className:"w-5 h-5"})})]})})}var M=c(88285),N=c(47089);let O=[{id:"recent",name:"最近使用",icon:"\uD83D\uDD52",emojis:[]},{id:"smileys",name:"表情",icon:"\uD83D\uDE00",emojis:[{emoji:"\uD83D\uDE00",name:"笑脸",category:"smileys",keywords:["笑","开心","happy"]},{emoji:"\uD83D\uDE03",name:"大笑",category:"smileys",keywords:["大笑","joy"]},{emoji:"\uD83D\uDE04",name:"微笑",category:"smileys",keywords:["微笑","smile"]},{emoji:"\uD83D\uDE01",name:"露齿笑",category:"smileys",keywords:["露齿","grin"]},{emoji:"\uD83D\uDE05",name:"汗笑",category:"smileys",keywords:["汗","sweat"]},{emoji:"\uD83D\uDE02",name:"笑哭",category:"smileys",keywords:["笑哭","laugh"]},{emoji:"\uD83E\uDD23",name:"笑翻",category:"smileys",keywords:["笑翻","rofl"]},{emoji:"\uD83D\uDE0A",name:"害羞笑",category:"smileys",keywords:["害羞","blush"]},{emoji:"\uD83D\uDE07",name:"天使笑",category:"smileys",keywords:["天使","angel"]},{emoji:"\uD83D\uDE42",name:"微笑",category:"smileys",keywords:["微笑","slight"]},{emoji:"\uD83D\uDE43",name:"倒笑",category:"smileys",keywords:["倒笑","upside"]},{emoji:"\uD83D\uDE09",name:"眨眼",category:"smileys",keywords:["眨眼","wink"]},{emoji:"\uD83D\uDE0C",name:"满足",category:"smileys",keywords:["满足","relieved"]},{emoji:"\uD83D\uDE0D",name:"爱心眼",category:"smileys",keywords:["爱心","heart"]},{emoji:"\uD83E\uDD70",name:"爱心脸",category:"smileys",keywords:["爱心脸","love"]},{emoji:"\uD83D\uDE18",name:"飞吻",category:"smileys",keywords:["飞吻","kiss"]},{emoji:"\uD83D\uDE17",name:"亲吻",category:"smileys",keywords:["亲吻","kiss"]},{emoji:"\uD83D\uDE19",name:"微笑亲吻",category:"smileys",keywords:["微笑亲吻"]},{emoji:"\uD83D\uDE1A",name:"闭眼亲吻",category:"smileys",keywords:["闭眼亲吻"]},{emoji:"\uD83D\uDE0B",name:"吐舌",category:"smileys",keywords:["吐舌","tongue"]},{emoji:"\uD83D\uDE1B",name:"吐舌",category:"smileys",keywords:["吐舌","tongue"]},{emoji:"\uD83D\uDE1D",name:"挤眼吐舌",category:"smileys",keywords:["挤眼吐舌"]},{emoji:"\uD83D\uDE1C",name:"眨眼吐舌",category:"smileys",keywords:["眨眼吐舌"]},{emoji:"\uD83E\uDD2A",name:"疯狂",category:"smileys",keywords:["疯狂","crazy"]},{emoji:"\uD83E\uDD28",name:"怀疑",category:"smileys",keywords:["怀疑","skeptical"]},{emoji:"\uD83E\uDDD0",name:"侦探",category:"smileys",keywords:["侦探","detective"]},{emoji:"\uD83E\uDD13",name:"书呆子",category:"smileys",keywords:["书呆子","nerd"]},{emoji:"\uD83D\uDE0E",name:"酷",category:"smileys",keywords:["酷","cool"]},{emoji:"\uD83E\uDD29",name:"星星眼",category:"smileys",keywords:["星星眼","star"]},{emoji:"\uD83E\uDD73",name:"派对",category:"smileys",keywords:["派对","party"]},{emoji:"\uD83D\uDE0F",name:"得意",category:"smileys",keywords:["得意","smirk"]},{emoji:"\uD83D\uDE12",name:"不满",category:"smileys",keywords:["不满","unamused"]},{emoji:"\uD83D\uDE1E",name:"失望",category:"smileys",keywords:["失望","disappointed"]},{emoji:"\uD83D\uDE14",name:"忧郁",category:"smileys",keywords:["忧郁","pensive"]},{emoji:"\uD83D\uDE1F",name:"担心",category:"smileys",keywords:["担心","worried"]},{emoji:"\uD83D\uDE15",name:"困惑",category:"smileys",keywords:["困惑","confused"]},{emoji:"\uD83D\uDE41",name:"轻微皱眉",category:"smileys",keywords:["皱眉","slight"]},{emoji:"☹️",name:"皱眉",category:"smileys",keywords:["皱眉","frown"]},{emoji:"\uD83D\uDE23",name:"痛苦",category:"smileys",keywords:["痛苦","persevere"]},{emoji:"\uD83D\uDE16",name:"困惑",category:"smileys",keywords:["困惑","confounded"]},{emoji:"\uD83D\uDE2B",name:"疲惫",category:"smileys",keywords:["疲惫","tired"]},{emoji:"\uD83D\uDE29",name:"疲惫",category:"smileys",keywords:["疲惫","weary"]},{emoji:"\uD83E\uDD7A",name:"恳求",category:"smileys",keywords:["恳求","pleading"]},{emoji:"\uD83D\uDE22",name:"哭泣",category:"smileys",keywords:["哭泣","cry"]},{emoji:"\uD83D\uDE2D",name:"大哭",category:"smileys",keywords:["大哭","sob"]},{emoji:"\uD83D\uDE24",name:"得意",category:"smileys",keywords:["得意","triumph"]},{emoji:"\uD83D\uDE20",name:"生气",category:"smileys",keywords:["生气","angry"]},{emoji:"\uD83D\uDE21",name:"愤怒",category:"smileys",keywords:["愤怒","rage"]},{emoji:"\uD83E\uDD2C",name:"咒骂",category:"smileys",keywords:["咒骂","cursing"]},{emoji:"\uD83E\uDD2F",name:"爆炸头",category:"smileys",keywords:["爆炸头","exploding"]},{emoji:"\uD83D\uDE33",name:"震惊",category:"smileys",keywords:["震惊","flushed"]},{emoji:"\uD83E\uDD75",name:"热",category:"smileys",keywords:["热","hot"]},{emoji:"\uD83E\uDD76",name:"冷",category:"smileys",keywords:["冷","cold"]},{emoji:"\uD83D\uDE31",name:"尖叫",category:"smileys",keywords:["尖叫","scream"]},{emoji:"\uD83D\uDE28",name:"恐惧",category:"smileys",keywords:["恐惧","fearful"]},{emoji:"\uD83D\uDE30",name:"焦虑",category:"smileys",keywords:["焦虑","anxious"]},{emoji:"\uD83D\uDE25",name:"失望",category:"smileys",keywords:["失望","disappointed"]},{emoji:"\uD83D\uDE13",name:"冷汗",category:"smileys",keywords:["冷汗","sweat"]},{emoji:"\uD83E\uDD17",name:"拥抱",category:"smileys",keywords:["拥抱","hug"]},{emoji:"\uD83E\uDD14",name:"思考",category:"smileys",keywords:["思考","thinking"]},{emoji:"\uD83E\uDD2D",name:"偷笑",category:"smileys",keywords:["偷笑","giggle"]},{emoji:"\uD83E\uDD2B",name:"嘘",category:"smileys",keywords:["嘘","shushing"]},{emoji:"\uD83E\uDD25",name:"说谎",category:"smileys",keywords:["说谎","lying"]},{emoji:"\uD83D\uDE36",name:"无语",category:"smileys",keywords:["无语","no-mouth"]},{emoji:"\uD83D\uDE10",name:"中性",category:"smileys",keywords:["中性","neutral"]},{emoji:"\uD83D\uDE11",name:"面无表情",category:"smileys",keywords:["面无表情","expressionless"]},{emoji:"\uD83D\uDE2F",name:"惊讶",category:"smileys",keywords:["惊讶","hushed"]},{emoji:"\uD83D\uDE26",name:"皱眉",category:"smileys",keywords:["皱眉","frown"]},{emoji:"\uD83D\uDE27",name:"痛苦",category:"smileys",keywords:["痛苦","anguished"]},{emoji:"\uD83D\uDE2E",name:"张嘴",category:"smileys",keywords:["张嘴","open-mouth"]},{emoji:"\uD83D\uDE32",name:"震惊",category:"smileys",keywords:["震惊","astonished"]},{emoji:"\uD83D\uDE34",name:"睡觉",category:"smileys",keywords:["睡觉","sleeping"]},{emoji:"\uD83E\uDD24",name:"流口水",category:"smileys",keywords:["流口水","drooling"]},{emoji:"\uD83D\uDE2A",name:"困倦",category:"smileys",keywords:["困倦","sleepy"]},{emoji:"\uD83D\uDE35",name:"头晕",category:"smileys",keywords:["头晕","dizzy"]},{emoji:"\uD83E\uDD10",name:"拉链嘴",category:"smileys",keywords:["拉链嘴","zipper"]},{emoji:"\uD83E\uDD74",name:"醉",category:"smileys",keywords:["醉","woozy"]},{emoji:"\uD83D\uDE37",name:"口罩",category:"smileys",keywords:["口罩","mask"]},{emoji:"\uD83E\uDD12",name:"发烧",category:"smileys",keywords:["发烧","fever"]},{emoji:"\uD83E\uDD15",name:"受伤",category:"smileys",keywords:["受伤","injured"]},{emoji:"\uD83E\uDD22",name:"恶心",category:"smileys",keywords:["恶心","nauseated"]},{emoji:"\uD83E\uDD2E",name:"呕吐",category:"smileys",keywords:["呕吐","vomiting"]},{emoji:"\uD83E\uDD27",name:"打喷嚏",category:"smileys",keywords:["打喷嚏","sneezing"]},{emoji:"\uD83D\uDE08",name:"恶魔",category:"smileys",keywords:["恶魔","imp"]},{emoji:"\uD83D\uDC7F",name:"愤怒恶魔",category:"smileys",keywords:["愤怒恶魔","angry-imp"]},{emoji:"\uD83D\uDC79",name:"食人魔",category:"smileys",keywords:["食人魔","ogre"]},{emoji:"\uD83D\uDC7A",name:"天狗",category:"smileys",keywords:["天狗","goblin"]},{emoji:"\uD83E\uDD21",name:"小丑",category:"smileys",keywords:["小丑","clown"]},{emoji:"\uD83D\uDC7B",name:"鬼",category:"smileys",keywords:["鬼","ghost"]},{emoji:"\uD83D\uDC7D",name:"外星人",category:"smileys",keywords:["外星人","alien"]},{emoji:"\uD83D\uDC7E",name:"外星怪物",category:"smileys",keywords:["外星怪物","alien-monster"]},{emoji:"\uD83E\uDD16",name:"机器人",category:"smileys",keywords:["机器人","robot"]},{emoji:"\uD83D\uDE3A",name:"笑猫",category:"smileys",keywords:["笑猫","grinning-cat"]},{emoji:"\uD83D\uDE38",name:"笑猫",category:"smileys",keywords:["笑猫","grinning-cat"]},{emoji:"\uD83D\uDE39",name:"笑哭猫",category:"smileys",keywords:["笑哭猫","joy-cat"]},{emoji:"\uD83D\uDE3B",name:"爱心猫",category:"smileys",keywords:["爱心猫","heart-eyes-cat"]},{emoji:"\uD83D\uDE3C",name:"得意猫",category:"smileys",keywords:["得意猫","smirk-cat"]},{emoji:"\uD83D\uDE3D",name:"亲吻猫",category:"smileys",keywords:["亲吻猫","kissing-cat"]},{emoji:"\uD83D\uDE40",name:"尖叫猫",category:"smileys",keywords:["尖叫猫","scream-cat"]},{emoji:"\uD83D\uDE3F",name:"哭泣猫",category:"smileys",keywords:["哭泣猫","crying-cat"]},{emoji:"\uD83D\uDE3E",name:"生气猫",category:"smileys",keywords:["生气猫","pouting-cat"]}]},{id:"gestures",name:"手势",icon:"\uD83D\uDC4B",emojis:[{emoji:"\uD83D\uDC4B",name:"挥手",category:"gestures",keywords:["挥手","wave","再见"]},{emoji:"\uD83E\uDD1A",name:"举手",category:"gestures",keywords:["举手","raised-hand"]},{emoji:"\uD83D\uDD90️",name:"手掌",category:"gestures",keywords:["手掌","hand"]},{emoji:"✋",name:"举手",category:"gestures",keywords:["举手","raised-hand"]},{emoji:"\uD83D\uDD96",name:"瓦肯手势",category:"gestures",keywords:["瓦肯","vulcan"]},{emoji:"\uD83D\uDC4C",name:"OK",category:"gestures",keywords:["OK","ok"]},{emoji:"\uD83E\uDD0C",name:"捏",category:"gestures",keywords:["捏","pinched"]},{emoji:"\uD83E\uDD0F",name:"捏",category:"gestures",keywords:["捏","pinching"]},{emoji:"✌️",name:"胜利",category:"gestures",keywords:["胜利","victory","peace"]},{emoji:"\uD83E\uDD1E",name:"交叉手指",category:"gestures",keywords:["交叉手指","crossed"]},{emoji:"\uD83E\uDD1F",name:"摇滚",category:"gestures",keywords:["摇滚","rock"]},{emoji:"\uD83E\uDD18",name:"摇滚",category:"gestures",keywords:["摇滚","rock"]},{emoji:"\uD83E\uDD19",name:"电话",category:"gestures",keywords:["电话","call"]},{emoji:"\uD83D\uDC48",name:"左指",category:"gestures",keywords:["左指","point-left"]},{emoji:"\uD83D\uDC49",name:"右指",category:"gestures",keywords:["右指","point-right"]},{emoji:"\uD83D\uDC46",name:"上指",category:"gestures",keywords:["上指","point-up"]},{emoji:"\uD83D\uDD95",name:"中指",category:"gestures",keywords:["中指","middle-finger"]},{emoji:"\uD83D\uDC47",name:"下指",category:"gestures",keywords:["下指","point-down"]},{emoji:"☝️",name:"上指",category:"gestures",keywords:["上指","point-up"]},{emoji:"\uD83D\uDC4D",name:"点赞",category:"gestures",keywords:["点赞","thumbs-up","好"]},{emoji:"\uD83D\uDC4E",name:"点踩",category:"gestures",keywords:["点踩","thumbs-down","不好"]},{emoji:"\uD83D\uDC4A",name:"拳头",category:"gestures",keywords:["拳头","fist"]},{emoji:"✊",name:"拳头",category:"gestures",keywords:["拳头","fist"]},{emoji:"\uD83E\uDD1B",name:"左拳",category:"gestures",keywords:["左拳","left-fist"]},{emoji:"\uD83E\uDD1C",name:"右拳",category:"gestures",keywords:["右拳","right-fist"]},{emoji:"\uD83D\uDC4F",name:"鼓掌",category:"gestures",keywords:["鼓掌","clap","拍手"]},{emoji:"\uD83D\uDE4C",name:"举手",category:"gestures",keywords:["举手","raised-hands"]},{emoji:"\uD83D\uDC50",name:"张开手",category:"gestures",keywords:["张开手","open-hands"]},{emoji:"\uD83E\uDD32",name:"祈祷",category:"gestures",keywords:["祈祷","praying"]},{emoji:"\uD83E\uDD1D",name:"握手",category:"gestures",keywords:["握手","handshake"]},{emoji:"\uD83D\uDE4F",name:"祈祷",category:"gestures",keywords:["祈祷","pray","拜托"]},{emoji:"✍️",name:"写字",category:"gestures",keywords:["写字","writing"]},{emoji:"\uD83D\uDCAA",name:"肌肉",category:"gestures",keywords:["肌肉","muscle","力量"]},{emoji:"\uD83E\uDDBE",name:"机械臂",category:"gestures",keywords:["机械臂","mechanical-arm"]},{emoji:"\uD83E\uDDBF",name:"机械腿",category:"gestures",keywords:["机械腿","mechanical-leg"]},{emoji:"\uD83E\uDDB5",name:"腿",category:"gestures",keywords:["腿","leg"]},{emoji:"\uD83E\uDDB6",name:"脚",category:"gestures",keywords:["脚","foot"]},{emoji:"\uD83D\uDC42",name:"耳朵",category:"gestures",keywords:["耳朵","ear"]},{emoji:"\uD83E\uDDBB",name:"助听器",category:"gestures",keywords:["助听器","ear-with-hearing-aid"]},{emoji:"\uD83D\uDC43",name:"鼻子",category:"gestures",keywords:["鼻子","nose"]},{emoji:"\uD83E\uDDE0",name:"大脑",category:"gestures",keywords:["大脑","brain"]},{emoji:"\uD83E\uDEC0",name:"心脏",category:"gestures",keywords:["心脏","heart"]},{emoji:"\uD83E\uDEC1",name:"肺",category:"gestures",keywords:["肺","lungs"]},{emoji:"\uD83E\uDDB7",name:"牙齿",category:"gestures",keywords:["牙齿","tooth"]},{emoji:"\uD83E\uDDB4",name:"骨头",category:"gestures",keywords:["骨头","bone"]},{emoji:"\uD83D\uDC40",name:"眼睛",category:"gestures",keywords:["眼睛","eyes"]},{emoji:"\uD83D\uDC41️",name:"眼睛",category:"gestures",keywords:["眼睛","eye"]},{emoji:"\uD83D\uDC45",name:"舌头",category:"gestures",keywords:["舌头","tongue"]},{emoji:"\uD83D\uDC44",name:"嘴巴",category:"gestures",keywords:["嘴巴","mouth"]},{emoji:"\uD83D\uDC8B",name:"唇印",category:"gestures",keywords:["唇印","kiss-mark"]},{emoji:"\uD83E\uDE78",name:"血滴",category:"gestures",keywords:["血滴","blood"]}]},{id:"objects",name:"物品",icon:"\uD83D\uDCA1",emojis:[{emoji:"\uD83D\uDCA1",name:"灯泡",category:"objects",keywords:["灯泡","light-bulb","想法"]},{emoji:"\uD83D\uDD26",name:"手电筒",category:"objects",keywords:["手电筒","flashlight"]},{emoji:"\uD83D\uDD6F️",name:"蜡烛",category:"objects",keywords:["蜡烛","candle"]},{emoji:"\uD83E\uDE94",name:"油灯",category:"objects",keywords:["油灯","diya-lamp"]},{emoji:"\uD83D\uDCBB",name:"笔记本电脑",category:"objects",keywords:["笔记本电脑","laptop"]},{emoji:"\uD83D\uDDA5️",name:"台式电脑",category:"objects",keywords:["台式电脑","desktop"]},{emoji:"\uD83D\uDDA8️",name:"打印机",category:"objects",keywords:["打印机","printer"]},{emoji:"⌨️",name:"键盘",category:"objects",keywords:["键盘","keyboard"]},{emoji:"\uD83D\uDDB1️",name:"鼠标",category:"objects",keywords:["鼠标","mouse"]},{emoji:"\uD83D\uDDB2️",name:"轨迹球",category:"objects",keywords:["轨迹球","trackball"]},{emoji:"\uD83D\uDCBD",name:"软盘",category:"objects",keywords:["软盘","floppy-disk"]},{emoji:"\uD83D\uDCBE",name:"软盘",category:"objects",keywords:["软盘","floppy-disk"]},{emoji:"\uD83D\uDCBF",name:"光盘",category:"objects",keywords:["光盘","optical-disk"]},{emoji:"\uD83D\uDCC0",name:"DVD",category:"objects",keywords:["DVD","dvd"]},{emoji:"\uD83D\uDCF1",name:"手机",category:"objects",keywords:["手机","mobile-phone"]},{emoji:"\uD83D\uDCF2",name:"手机",category:"objects",keywords:["手机","mobile-phone"]},{emoji:"☎️",name:"电话",category:"objects",keywords:["电话","telephone"]},{emoji:"\uD83D\uDCDE",name:"电话",category:"objects",keywords:["电话","telephone"]},{emoji:"\uD83D\uDCDF",name:"寻呼机",category:"objects",keywords:["寻呼机","pager"]},{emoji:"\uD83D\uDCE0",name:"传真机",category:"objects",keywords:["传真机","fax"]},{emoji:"\uD83D\uDD0B",name:"电池",category:"objects",keywords:["电池","battery"]},{emoji:"\uD83D\uDD0C",name:"插头",category:"objects",keywords:["插头","electric-plug"]},{emoji:"\uD83D\uDCBB",name:"笔记本电脑",category:"objects",keywords:["笔记本电脑","laptop"]},{emoji:"\uD83D\uDDA5️",name:"台式电脑",category:"objects",keywords:["台式电脑","desktop"]},{emoji:"\uD83D\uDDA8️",name:"打印机",category:"objects",keywords:["打印机","printer"]},{emoji:"⌨️",name:"键盘",category:"objects",keywords:["键盘","keyboard"]},{emoji:"\uD83D\uDDB1️",name:"鼠标",category:"objects",keywords:["鼠标","mouse"]},{emoji:"\uD83D\uDDB2️",name:"轨迹球",category:"objects",keywords:["轨迹球","trackball"]},{emoji:"\uD83D\uDCBD",name:"软盘",category:"objects",keywords:["软盘","floppy-disk"]},{emoji:"\uD83D\uDCBE",name:"软盘",category:"objects",keywords:["软盘","floppy-disk"]},{emoji:"\uD83D\uDCBF",name:"光盘",category:"objects",keywords:["光盘","optical-disk"]},{emoji:"\uD83D\uDCC0",name:"DVD",category:"objects",keywords:["DVD","dvd"]},{emoji:"\uD83D\uDCF1",name:"手机",category:"objects",keywords:["手机","mobile-phone"]},{emoji:"\uD83D\uDCF2",name:"手机",category:"objects",keywords:["手机","mobile-phone"]},{emoji:"☎️",name:"电话",category:"objects",keywords:["电话","telephone"]},{emoji:"\uD83D\uDCDE",name:"电话",category:"objects",keywords:["电话","telephone"]},{emoji:"\uD83D\uDCDF",name:"寻呼机",category:"objects",keywords:["寻呼机","pager"]},{emoji:"\uD83D\uDCE0",name:"传真机",category:"objects",keywords:["传真机","fax"]},{emoji:"\uD83D\uDD0B",name:"电池",category:"objects",keywords:["电池","battery"]},{emoji:"\uD83D\uDD0C",name:"插头",category:"objects",keywords:["插头","electric-plug"]}]}],P=O.flatMap(a=>a.emojis),Q="recent-emojis";function R(){try{return JSON.parse(localStorage.getItem(Q)||"[]")}catch{return[]}}function S({onSelect:a}){let[b,c]=(0,e.useState)("recent"),[f,h]=(0,e.useState)(""),[i,j]=(0,e.useState)([]),k=(()=>{if(f){let a=f.toLowerCase();return P.filter(b=>b.name.toLowerCase().includes(a)||b.keywords.some(b=>b.toLowerCase().includes(a)))}return"recent"===b?i.map(a=>({emoji:a,name:"最近使用",category:"recent",keywords:[]})):O.find(a=>a.id===b)?.emojis||[]})();return(0,d.jsxs)(g.P.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-white rounded-2xl shadow-apple-lg border border-gray-200 max-h-96 overflow-hidden",children:[(0,d.jsx)("div",{className:"p-3 border-b border-gray-100",children:(0,d.jsxs)("div",{className:"relative",children:[(0,d.jsx)(M.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),(0,d.jsx)("input",{type:"text",placeholder:"搜索表情...",value:f,onChange:a=>h(a.target.value),className:"w-full pl-10 pr-10 py-2 bg-gray-50 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent text-sm"}),f&&(0,d.jsx)("button",{onClick:()=>h(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:(0,d.jsx)(N.A,{className:"w-4 h-4"})})]})}),!f&&(0,d.jsx)("div",{className:"flex border-b border-gray-100",children:O.map(a=>(0,d.jsx)("button",{onClick:()=>c(a.id),className:(0,A.cn)("flex-1 py-2 text-center text-sm transition-colors",b===a.id?"text-primary-600 border-b-2 border-primary-600":"text-gray-500 hover:text-gray-700"),children:(0,d.jsx)("span",{className:"text-lg",children:a.icon})},a.id))}),(0,d.jsxs)("div",{className:"p-3 max-h-64 overflow-y-auto",children:[(0,d.jsx)("div",{className:"grid grid-cols-8 gap-1",children:k.map((b,c)=>(0,d.jsx)(g.P.button,{onClick:()=>(b=>{try{let a=R(),c=[b,...a.filter(a=>a!==b)].slice(0,30);localStorage.setItem(Q,JSON.stringify(c))}catch(a){console.warn("Failed to save recent emoji:",a)}j(R()),a(b)})(b.emoji),whileHover:{scale:1.1},whileTap:{scale:.9},className:"w-8 h-8 flex items-center justify-center text-lg hover:bg-gray-100 rounded transition-colors",title:b.name,children:b.emoji},`${b.emoji}-${c}`))}),0===k.length&&(0,d.jsx)("div",{className:"text-center py-8 text-gray-500",children:(0,d.jsx)("p",{className:"text-sm",children:"没有找到相关表情"})})]})]})}var T=c(49269),U=c(30029),V=c(15161),W=c(31851),X=c(33872);function Y({imageUrl:a,onClose:b}){let[c,h]=(0,e.useState)(1),[i,j]=(0,e.useState)(0),[k,l]=(0,e.useState)({x:0,y:0}),[m,n]=(0,e.useState)(!1),[o,p]=(0,e.useState)({x:0,y:0}),q=(0,e.useRef)(null),r=()=>{n(!1)},s=async()=>{if(navigator.share)try{await navigator.share({title:"分享图片",text:"查看这张图片",url:a})}catch(a){console.log("分享失败:",a)}else navigator.clipboard.writeText(a)};return(0,d.jsx)(f.N,{children:(0,d.jsxs)(g.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/90 z-50 flex items-center justify-center",onClick:b,children:[(0,d.jsxs)("div",{className:"absolute top-4 right-4 flex items-center space-x-2 z-10",children:[(0,d.jsx)("button",{onClick:()=>{let b=document.createElement("a");b.href=a,b.download="image.jpg",document.body.appendChild(b),b.click(),document.body.removeChild(b)},className:"p-2 bg-white/20 backdrop-blur-sm rounded-full text-white hover:bg-white/30 transition-colors",children:(0,d.jsx)(T.A,{className:"w-5 h-5"})}),(0,d.jsx)("button",{onClick:s,className:"p-2 bg-white/20 backdrop-blur-sm rounded-full text-white hover:bg-white/30 transition-colors",children:(0,d.jsx)(U.A,{className:"w-5 h-5"})}),(0,d.jsx)("button",{onClick:()=>{h(1),j(0),l({x:0,y:0})},className:"p-2 bg-white/20 backdrop-blur-sm rounded-full text-white hover:bg-white/30 transition-colors",children:(0,d.jsx)(V.A,{className:"w-5 h-5"})}),(0,d.jsx)("button",{onClick:b,className:"p-2 bg-white/20 backdrop-blur-sm rounded-full text-white hover:bg-white/30 transition-colors",children:(0,d.jsx)(N.A,{className:"w-5 h-5"})})]}),(0,d.jsxs)("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 flex items-center space-x-2 z-10",children:[(0,d.jsx)("button",{onClick:()=>h(a=>Math.max(.5,a/1.2)),className:"p-2 bg-white/20 backdrop-blur-sm rounded-full text-white hover:bg-white/30 transition-colors",children:(0,d.jsx)(W.A,{className:"w-5 h-5"})}),(0,d.jsxs)("span",{className:"text-white text-sm px-3 py-1 bg-white/20 backdrop-blur-sm rounded-full",children:[Math.round(100*c),"%"]}),(0,d.jsx)("button",{onClick:()=>h(a=>Math.min(3,1.2*a)),className:"p-2 bg-white/20 backdrop-blur-sm rounded-full text-white hover:bg-white/30 transition-colors",children:(0,d.jsx)(X.A,{className:"w-5 h-5"})})]}),(0,d.jsx)("div",{className:"relative w-full h-full flex items-center justify-center overflow-hidden",onMouseDown:a=>{c>1&&(n(!0),p({x:a.clientX-k.x,y:a.clientY-k.y}))},onMouseMove:a=>{m&&l({x:a.clientX-o.x,y:a.clientY-o.y})},onMouseUp:r,onMouseLeave:r,onWheel:a=>{a.preventDefault();let b=a.deltaY>0?.9:1.1;h(a=>Math.max(.5,Math.min(3,a*b)))},onClick:a=>a.stopPropagation(),children:(0,d.jsx)(g.P.img,{ref:q,src:a,alt:"查看图片",className:"max-w-full max-h-full object-contain",style:{cursor:c>1?m?"grabbing":"grab":"default",transform:`scale(${c}) rotate(${i}deg) translate(${k.x}px, ${k.y}px)`,transformOrigin:"center"},drag:c>1,dragConstraints:{left:-100,right:100,top:-100,bottom:100},dragElastic:.1,dragMomentum:!1,onDoubleClick:()=>h(a=>1===a?2:1)})}),(0,d.jsx)("div",{className:"absolute bottom-20 left-1/2 transform -translate-x-1/2 text-white/60 text-sm text-center",children:(0,d.jsx)("p",{children:"双击缩放 • 滚轮缩放 • 拖拽移动 • ESC关闭"})})]})})}var Z=c(78422),$=c(40280),_=c(3991),aa=c.n(_);function ab({conversations:a,currentUserId:b,activeId:c,onSelect:f}){let[h,i]=(0,e.useState)(""),j=(0,e.useMemo)(()=>{let c=h.trim().toLowerCase();return a.filter(a=>{let d=a.participants.find(a=>a.id!==b),e=(a.isGroup?a.groupName:d?.name)||"",f=a.lastMessagePreview||"";return e.toLowerCase().includes(c)||f.toLowerCase().includes(c)}).sort((a,b)=>{let c=+!!a.pinned,d=+!!b.pinned;if(c!==d)return d-c;let e=a.updatedAt?new Date(a.updatedAt).getTime():0;return(b.updatedAt?new Date(b.updatedAt).getTime():0)-e})},[a,b,h]);return(0,d.jsxs)("div",{className:"h-full flex flex-col border-r",style:{borderColor:"var(--border)"},children:[(0,d.jsx)("div",{className:"p-3",children:(0,d.jsxs)("div",{className:"flex items-center gap-2 bg-white rounded-xl border px-3 py-2 shadow-sm",style:{borderColor:"var(--border)"},children:[(0,d.jsx)(M.A,{className:"w-4 h-4 text-gray-400"}),(0,d.jsx)("input",{value:h,onChange:a=>i(a.target.value),placeholder:"搜索",className:"flex-1 outline-none bg-transparent text-sm"})]})}),(0,d.jsxs)("div",{className:"flex-1 overflow-y-auto",children:[j.map(a=>{let e=a.participants.find(a=>a.id!==b),h=a.id===c;return(0,d.jsx)(aa(),{href:`/chats/${a.id}`,className:"block",onClick:()=>f(a.id),children:(0,d.jsxs)(g.P.div,{initial:{opacity:0,y:6},animate:{opacity:1,y:0},transition:{duration:.15},className:(0,A.cn)("w-full px-3 py-2 flex items-center gap-3 hover:bg-gray-50",h&&"bg-gray-100"),children:[(0,d.jsxs)("div",{className:"relative",children:[(0,d.jsx)("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-primary-400 to-primary-600 flex items-center justify-center text-white font-medium",children:(a.isGroup?a.groupName?.charAt(0):e?.name?.charAt(0))||"U"}),(e?.isOnline||a.isGroup)&&(0,d.jsx)("div",{className:"absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-green-500 rounded-full border-2 border-white"})]}),(0,d.jsxs)("div",{className:"flex-1 text-left",children:[(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)("div",{className:"font-medium text-gray-900 truncate",children:a.isGroup?a.groupName:e?.name}),a.pinned&&(0,d.jsx)(Z.A,{className:"w-3 h-3 text-gray-400"}),a.muted&&(0,d.jsx)($.A,{className:"w-3 h-3 text-gray-400"})]}),(0,d.jsx)("div",{className:"text-xs text-gray-500 truncate",children:a.lastMessagePreview||"开始聊天吧"})]}),(0,d.jsxs)("div",{className:"ml-auto flex flex-col items-end gap-1",children:[(0,d.jsx)("div",{className:"text-xs text-gray-400",children:a.updatedAt?new Date(a.updatedAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):""}),a.unreadCount>0&&(0,d.jsx)("div",{className:"min-w-[20px] px-1.5 h-5 rounded-full bg-primary-500 text-white text-[10px] flex items-center justify-center",children:a.unreadCount})]})]})},a.id)}),0===j.length&&(0,d.jsx)("div",{className:"px-4 py-6 text-sm text-gray-500",children:"未找到相关会话"})]})]})}var ac=c(47268);function ad({open:a,onClose:b,conversation:c,currentUserId:h,onTogglePin:i,onToggleMute:j}){let k=(0,e.useMemo)(()=>c.participants.filter(a=>a.id!==h),[c,h]),[l,m]=(0,e.useState)({}),n=l[c.id]||"";return(0,d.jsx)(f.N,{children:a&&(0,d.jsx)(g.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-40 bg-black/30",onClick:b,children:(0,d.jsxs)(g.P.aside,{initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:{type:"tween",duration:.2},className:"absolute right-0 top-0 bottom-0 w-[320px] bg-white shadow-xl border-l",style:{borderColor:"var(--border)"},onClick:a=>a.stopPropagation(),children:[(0,d.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",style:{borderColor:"var(--border)"},children:[(0,d.jsx)("div",{className:"font-semibold text-gray-900",children:"会话信息"}),(0,d.jsx)("button",{onClick:b,className:"icon-btn",children:(0,d.jsx)(N.A,{className:"w-5 h-5"})})]}),(0,d.jsxs)("div",{className:"p-4 border-b",style:{borderColor:"var(--border)"},children:[(0,d.jsx)("div",{className:"text-sm font-medium text-gray-700 mb-2",children:"成员"}),(0,d.jsx)("div",{className:"space-y-2",children:k.map(a=>(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-primary-400 to-primary-600 flex items-center justify-center text-white text-xs font-medium",children:a.name?.charAt(0)||"U"}),(0,d.jsxs)("div",{children:[(0,d.jsx)("div",{className:"text-sm text-gray-900",children:a.name}),(0,d.jsx)("div",{className:"text-xs text-gray-500",children:a.isOnline?"在线":"离线"})]})]},a.id))})]}),(0,d.jsxs)("div",{className:"p-4 border-b",style:{borderColor:"var(--border)"},children:[(0,d.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,d.jsx)("div",{className:"text-sm font-medium text-gray-700",children:"备注"}),(0,d.jsx)("div",{className:"text-xs text-gray-400",children:"仅本机可见"})]}),(0,d.jsx)("textarea",{value:n,onChange:a=>(a=>{let b={...l,[c.id]:a};m(b);try{localStorage.setItem("chat:conv_notes",JSON.stringify(b))}catch{}})(a.target.value),placeholder:"添加一些对该对话的备注...",className:"w-full h-24 p-2 rounded border text-sm focus:outline-none focus:ring-2 focus:ring-primary-500",style:{borderColor:"var(--border)"}})]}),(0,d.jsxs)("div",{className:"p-4 space-y-3",children:[(0,d.jsxs)("button",{onClick:()=>{try{i(c.id,!c.pinned)}catch(a){console.error("Failed to toggle pin:",a)}},className:"w-full flex items-center gap-2 px-3 py-2 rounded border hover:bg-gray-50",style:{borderColor:"var(--border)"},children:[(0,d.jsx)(Z.A,{className:"w-4 h-4 text-gray-600"}),(0,d.jsx)("span",{className:"text-sm text-gray-800",children:c.pinned?"取消置顶":"置顶此会话"})]}),(0,d.jsxs)("button",{onClick:()=>j(c.id,!c.muted),className:"w-full flex items-center gap-2 px-3 py-2 rounded border hover:bg-gray-50",style:{borderColor:"var(--border)"},children:[c.muted?(0,d.jsx)(ac.A,{className:"w-4 h-4 text-gray-600"}):(0,d.jsx)($.A,{className:"w-4 h-4 text-gray-600"}),(0,d.jsx)("span",{className:"text-sm text-gray-800",children:c.muted?"取消静音":"静音此会话"})]})]})]})})})}var ae=c(62070),af=c(42378);function ag(){let a="1"===process.env.NEXT_PUBLIC_E2E,b="undefined"!=typeof navigator&&!0===navigator.webdriver,c=(0,af.useRouter)(),[h,i]=(0,e.useState)([]),[j,k]=(0,e.useState)({id:"1",name:"我",avatar:"/avatars/user1.jpg",isOnline:!0}),[n,o]=(0,e.useState)([]),[p,q]=(0,e.useState)("1"),r=(0,e.useMemo)(()=>n.find(a=>a.id===p)||null,[n,p]),[s,t]=(0,e.useState)(!1),[u,v]=(0,e.useState)(null),[w,x]=(0,e.useState)(""),[y,z]=(0,e.useState)(!1),[A,B]=(0,e.useState)(void 0),[C,E]=(0,e.useState)(null),{isEnabled:F,isEstablishing:G,error:H,enable:I,disable:J,encryptMessage:K}=(0,ae.f)({participants:["1","2"],autoEnable:!(a||b)}),M=async(a,b="text")=>{try{let c=a;if("text"===b&&F)try{let b=await K(a,j.id);c=JSON.stringify(b)}catch(a){console.error("加密失败:",a)}let d={id:Date.now().toString(),content:c,type:b,senderId:j.id,timestamp:new Date,status:"sending",...C?{replyTo:C}:{}};if(i(a=>[...a,d]),x(""),E(null),t(!1),setTimeout(()=>{i(a=>a.map(a=>a.id===d.id?{...a,status:"sent"}:a))},500),setTimeout(()=>{i(a=>a.map(a=>a.id===d.id?{...a,status:"delivered"}:a))},1200),setTimeout(()=>{i(a=>a.map(a=>a.id===d.id?{...a,status:"read"}:a))},2500),o(c=>c.map(c=>c.id===p?{...c,lastMessagePreview:"text"===b?a:"图片",updatedAt:new Date().toISOString(),unreadCount:0}:c)),"text"===b)try{let b=await fetch("/api/chat",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({messages:[{role:"user",content:a}]})});if(b.ok){let a=await b.json(),c={id:(Date.now()+Math.random()).toString(),content:String(a.content??"OK"),type:"text",senderId:"2",timestamp:new Date,status:"read"};i(a=>[...a,c]),o(a=>a.map(a=>a.id===p?{...a,lastMessagePreview:c.content,updatedAt:new Date().toISOString()}:a))}}catch(a){console.error("调用假模型失败",a)}}catch(a){console.error("发送消息失败:",a)}},N=async()=>{if(F)J();else try{await I()}catch(a){console.error("启用加密失败:",a)}};return(0,d.jsxs)("div",{className:"flex h-screen",style:{background:"var(--surface)"},"data-testid":"chat-root",children:[(0,d.jsx)("div",{className:"hidden md:flex w-72 flex-col",style:{background:"var(--bg)"},children:(0,d.jsx)(ab,{conversations:n,currentUserId:j.id,activeId:p,onSelect:a=>{q(a),z(!1)}})}),(0,d.jsxs)("div",{className:"flex-1 flex flex-col",children:[(0,d.jsx)("div",{className:"px-4 py-2 border-b",style:{background:"var(--bg)",borderColor:"var(--border)"},children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsx)(l.A,{isEnabled:F,isEstablishing:G,error:H??"",onToggle:N}),(0,d.jsx)("button",{className:"icon-btn",onClick:()=>z(!0),children:"详情"})]})}),r&&(0,d.jsx)(m,{conversation:r,isEncryptionEnabled:F,isEncryptionEstablishing:G,typingText:A??"",onStartCall:()=>c.push("/call"),onStartVideo:()=>c.push("/call"),onOpenInfo:()=>z(!0)}),(0,d.jsx)("div",{className:"flex-1 overflow-hidden",children:(0,d.jsx)(D,{messages:h,currentUserId:j.id,onImageClick:v,onReply:a=>E(a),onDelete:a=>i(b=>b.filter(b=>b.id!==a)),onToggleStar:a=>i(b=>b.map(b=>b.id===a?{...b,starred:!b.starred}:b)),onRetry:a=>(a=>{let b=h.find(b=>b.id===a);if(!b)return;let c="upload-"+Date.now();i(b=>b.map(b=>b.id===a?{...b,id:c,status:"sending",uploadProgress:1}:b));let d=1,e=setInterval(()=>{d=Math.min(100,d+Math.round(20*Math.random())),i(a=>a.map(a=>a.id===c?{...a,uploadProgress:d}:a)),d>=100&&(clearInterval(e),M(b.content,"image"),i(a=>a.filter(a=>a.id!==c)))},300)})(a)})}),(0,d.jsxs)("div",{className:"relative",children:[C&&(0,d.jsxs)("div",{className:"px-4 py-2 text-xs text-gray-600 flex items-center justify-between border-b",style:{borderColor:"var(--border)"},children:[(0,d.jsxs)("div",{children:["回复 \xb7 #",C]}),(0,d.jsx)("button",{className:"text-primary-600",onClick:()=>E(null),children:"取消"})]}),(0,d.jsx)(L,{value:w,onChange:x,onSend:M,onEmojiClick:()=>t(!s),onImageSelect:a=>{let b=new FileReader;b.onload=a=>{let b=a.target?.result,c="upload-"+Date.now(),d={id:c,content:b,type:"image",senderId:j.id,timestamp:new Date,status:"sending",uploadProgress:1};i(a=>[...a,d]);let e=1,f=setInterval(()=>{e=Math.min(100,e+Math.round(20*Math.random())),i(a=>a.map(a=>a.id===c?{...a,uploadProgress:e}:a)),e>=100&&(clearInterval(f),M(b,"image"),i(a=>a.filter(a=>a.id!==c)))},300);setTimeout(()=>{.05>Math.random()&&(clearInterval(f),i(a=>a.map(a=>a.id===c?{...a,status:"failed",uploadProgress:void 0}:a)))},2500)},b.readAsDataURL(a)}}),(0,d.jsx)(f.N,{children:s&&(0,d.jsx)(g.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},transition:{duration:.2},className:"absolute bottom-full left-0 right-0 mb-2",children:(0,d.jsx)(S,{onSelect:a=>x(b=>b+a)})})})]})]}),r&&(0,d.jsx)(ad,{open:y,onClose:()=>z(!1),conversation:r,currentUserId:j.id,onTogglePin:(a,b)=>o(c=>c.map(c=>c.id===a?{...c,pinned:b}:c)),onToggleMute:(a,b)=>o(c=>c.map(c=>c.id===a?{...c,muted:b}:c))}),(0,d.jsx)(f.N,{children:u&&(0,d.jsx)(Y,{imageUrl:u,onClose:()=>v(null)})})]})}}};